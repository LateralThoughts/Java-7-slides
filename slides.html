<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<title>What's new in Java 7</title>
		<meta name="description" content="Summary of Java 7 goodies: project coin, new filesystem API, fork/join."/>
		<meta name="author" content="Florent Biville"/>

		<meta name="viewport" content="width=device-width,initial-scale=1"/>
		<link href="css/shCoreEclipse.css" rel="stylesheet"/>
		<link href="css/shThemeEclipse.css" rel="stylesheet"/>
		<link href="css/slides.css" rel="stylesheet"/>
		
		<script src="js/shCore.js"></script>
		<script src="js/shBrushJava.js"></script>
	</head>
	<body>
		<div id="impress">
			<div class="step slide" data-x="0" data-y="-1500">
				<h1>What's new in <img src="img/JAVA_logo.png" alt="Java" id="java" title="Java" /> 7?</h1>
				<p id="subtitle" class="note">(yeah, what's new?)</p>
			</div>

			<div class="step slide" data-x="0" data-y="-750">
				<h2>Reminder / Some facts</h2>
				<ul>
					<li>Java <span class="important"><acronym title="Standard Edition">SE</acronym></span> 7</li>
					<li>Public release: July 7, 2011</li>
					<li>Java SE 6 <acronym title="End Of Life">EOL</acronym>: July 2012 <span class="note">(check <a href="http://www.oracle.com/technetwork/java/eol-135779.html">this</a> out)</span></li>					
				</ul>
			</div>

			<div class="step slide" data-x="0" data-y="0">
				<h2>Table of contents</h2>
				<ol>
					<li>Project coin</li>
					<li>New Filesystem API</li>
					<li>Fork/join</li>
				</ol>
			</div>

			<div class="step slide newSection" data-x="0" data-y="750">
				<img src="img/projectCoin.png" alt="" />
				<h2>Project coin</h2>
			</div>

			<div class="step slide" data-x="-2250" data-y="1500">
				<h2>Project coin?</h2>
				<ul>
					<li>Defined in <a href="http://jcp.org/en/jsr/detail?id=334"><acronym title="Java Specification Request">JSR</acronym> 334</a></li>
					<li>Public requests for small language improvements</li>
					<li>Active from Feb 29 to Mar 31, 2009</li>
				</ul>
				<p id="projectCoinFocus">Covered today</p>
				<ul id="projectCoinToC">
					<li>ASCII art</li>
					<li>Safer try-catch</li>
					<li>Compacter catch</li>
					<li>Diamonds</li>
					<li>Match more</li>
				</ul>
			</div>

			<div class="step slide" data-x="-750" data-y="1500">
				<h2>Project coin / ASCII art:before</h2>
				<pre class="brush: java">
long sooooooLong = 1297456456544564644L;
long whatWhat = 0x1F3C0A9FABC634EEL;
float pi = 3.141592653589793238462643383279230F;
//long aBitLong = 0b10100001L;//no binary literals before v7 ;)</pre>
			</div>

			<div class="step slide" data-x="-750" data-y="2250">
				<h2>Project coin / ASCII art:after</h2>
				<pre class="brush: java">
long sooooooLong = 1_297_456_456_544_564_644L;
long whatWhat = 0x1F3C_0A9F_ABC6_34EEL;
float pi = 3.141_592_653_589_793_238_462_643_383_279_230F;
long aBitLong = 0b1010_0001L;</pre>
			</div>

			<div id="bond" class="step slide" data-x="-750" data-y="3000">
				<h2>Project coin / Advanced ASCII art <span class="note">(no compiler was harmed in the making of this slide)</span></h2>
				<pre class="brush: java">
		// Courtesy Josh Bloch
		int bond =
          0000_____________0000________0000000000000000__000000000000000000+
        00000000_________00000000______000000000000000__0000000000000000000+
       000____000_______000____000_____000_______0000__00______0+
      000______000_____000______000_____________0000___00______0+
     0000______0000___0000______0000___________0000_____0_____0+
     0000______0000___0000______0000__________0000___________0+
     0000______0000___0000______0000_________0000__0000_00000+
     0000______0000___0000______0000________0000+
      000______000_____000______000________0000+
       000____000_______000____000_______00000+
        00000000_________00000000_______0000000+
          0000_____________0000________000000007;</pre>
			</div>

			<div class="step slide" data-x="750" data-y="1500">
				<h2>Project coin / Safer try-catch:before</h2>
				<pre class="brush: java">
		OutputStreamWriter outputStreamWriter = null;
		OutputStreamWriter outputStreamWriter2 = null;
		try {
			outputStreamWriter = new OutputStreamWriter(new FileOutputStream(new File("/tmp/dummy.txt")));
			outputStreamWriter2 = new OutputStreamWriter(new FileOutputStream(new File("/tmp/dummy2.txt")));
			outputStreamWriter.append("Bêh");
			outputStreamWriter2.append("Bêh2");
		}
		catch (FileNotFoundException e) {
			// handle exception
		}
		catch (IOException e) {
			// handle exception
		}
		finally {
			if (outputStreamWriter != null) {
				try {
					outputStreamWriter.close();
				}
				catch (IOException e) {
					// handle exception
				}
			}
			if (outputStreamWriter2 != null) {
				try {
					outputStreamWriter2.close();
				}
				catch (IOException e) {
					// handle exception
				}
			}
		}</pre>
			</div>

			<div class="step slide" data-x="750" data-y="2500">
				<h2>Project coin / Safer try-catch:after</h2>
				<pre class="brush: java">
		try (OutputStreamWriter outputStreamWriter = new OutputStreamWriter(new FileOutputStream(new File("/tmp/dummy.txt"))); 
			OutputStreamWriter outputStreamWriter2 = new OutputStreamWriter(new FileOutputStream(new File("/tmp/dummy2.txt")))) {
			outputStreamWriter.append("Bêh");
			outputStreamWriter2.append("Bêh2");
		}
		catch (FileNotFoundException e) {
			// handle exception
		}
		catch (IOException e) {
			// handle exception
		}</pre>
			</div>

			<div class="step slide" data-x="750" data-y="3250">
				<h2>Project coin / Safer try-catch</h2>
				<ul>
					<li>a.k.a. &ldquo;try-with-resources&rdquo;</li>
					<li>resource: any object whose class extends <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html">java.lang.AutoCloseable</a></li>
					<li>1 method to implement: close</li>
					<li><a href="http://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html">java.io.Closeable</a> (introduced in Java 1.5, implemented by OutputStreamWriter for instance) has been retrofitted to extend AutoCloseable</li>
				</ul>				
			</div>

			<div class="step slide" data-x="750" data-y="4250">
				<h2>Project coin / Safer try-catch: about suppressed exceptions</h2>
				<pre class="brush: java">
				package net.florent.biville.projectcoin.trywithresources;

				public class SuppressedExceptions {

					@SuppressWarnings("serial")
					private static class MySuperException extends Exception {
						public MySuperException(String msg) {
							super(msg);
						}
					}

					private static class MyAutoClose implements AutoCloseable {

						@Override
						public void close() {
							System.out.println("close is invoked!");
							throw new RuntimeException(">>> CLOSE <<<");
						}

						public void doSomething() throws MySuperException {
							System.out.println("doSomething is invoked");
							throw new MySuperException(">>> DOSOMETHING <<<");
						}

					}

					public static void main(String... strings) throws Exception {
						MyAutoClose myAutoClose = new MyAutoClose();
						try {
							myAutoClose.doSomething();
						}
						finally {
							myAutoClose.close();
						}
					}
				}</pre>	
			</div>

			<div class="step slide" data-x="750" data-y="5000">
				<h2>Project coin / Safer try-catch: about suppressed exceptions</h2>
				<p>Result:<br/>
					<pre class="executionError">Exception in thread "main" doSomething is invoked
close is invoked!
java.lang.RuntimeException: >>> CLOSE <<<
	at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions$MyAutoClose.close(SuppressedExceptions.java:16)
	at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions.main(SuppressedExceptions.java:32)</pre>
				</p>
				<p class="fat">Where is <span class="strike">Waldo</span> MySuperException?</p>
			</div>

			<div class="step slide" data-x="750" data-y="5750">
				<h2>Project coin / Safer try-catch: about suppressed exceptions</h2>
				<pre class="brush: java">
					public static void main(String... strings) throws Exception {
						MyAutoClose myAutoClose = new MyAutoClose();
						MySuperException mySuperException = null;
						try {
							myAutoClose.doSomething();
						}
						catch (MySuperException mse) {
							mySuperException = mse;
							throw mse;
						}
						finally {
							if (mySuperException != null) {
								try {
									myAutoClose.close();
								}
								catch (Exception e) {
									mySuperException.addSuppressed(e);
								}
							}
							else {
								myAutoClose.close();
							}
						}
					}</pre>	
			</div>

			<div class="step slide" data-x="750" data-y="6500">
				<h2>Project coin / Safer try-catch: about suppressed exceptions</h2>
				<p>Result:<br/>
					<pre class="executionError">doSomething is invoked
Exception in thread "main" net.florent.biville.projectcoin.trywithresources.SuppressedExceptions$MySuperException: >>> DOSOMETHING <<<
close is invoked!
	at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions$MyAutoClose.doSomething(SuppressedExceptions.java:22)
	at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions.main(SuppressedExceptions.java:31)
	Suppressed: java.lang.RuntimeException: >>> CLOSE <<<
		at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions$MyAutoClose.close(SuppressedExceptions.java:17)
		at net.florent.biville.projectcoin.trywithresources.SuppressedExceptions.main(SuppressedExceptions.java:40)</pre>
				</p>
			</div>

			<div class="step slide" data-x="750" data-y="7250">
				<h2>Project coin / Safer try-catch</h2>
				<p>And the same result can be achieved with:</p>
				<pre class="brush: java">
				public static void main(String... strings) throws Exception {
					try (MyAutoClose myAutoClose = new MyAutoClose();) {
						myAutoClose.doSomething();
					}
				}</pre>	
				<p>Do you understand why this is safer now? :)</p>			
			</div>

			<div class="step slide" data-x="2250" data-y="1500">
				<h2>Project coin / Compacter catch:before <span class="note">(don't try this at home!)</span></h2>
				<pre class="brush: java">
				public static void main(String... args) {
					String immutable = "immutable?";
					modifyStringBwahahaha(immutable);
					System.out.println(immutable);
				}

				public static void modifyStringBwahahaha(String string) {
					try {
						Field backedArrayField = String.class.getDeclaredField("value");
						backedArrayField.setAccessible(true);
						backedArrayField.set(string, string.toUpperCase().toCharArray());
					}
					catch (NoSuchFieldException e) {
						// handle exception
					}
					catch (SecurityException e) {
						// handle exception
					}
					catch (IllegalArgumentException e) {
						// handle exception
					}
					catch (IllegalAccessException e) {
						// handle exception
					}
				}</pre>			
			</div>

			<div class="step slide" data-x="2250" data-y="2250">
				<h2>Project coin / Compacter catch:before... <em>easy!</em></h2>
				<pre class="brush: java">
				public static void modifyStringBwahahaha(String string) {
					try {
						Field backedArrayField = String.class.getDeclaredField("value");
						backedArrayField.setAccessible(true);
						backedArrayField.set(string, string.toUpperCase().toCharArray());
					}
					catch (Throwable e) {
						// (also) catching a VirtualMachineError, hmm?
					}
				}</pre>				
			</div>

			<div class="step slide" data-x="2250" data-y="3000">
				<h2>Project coin / Compacter catch:after</em></h2>
				<pre class="brush: java">
				public static void modifyStringBwahahaha(String string) {
					try {
						Field backedArrayField = String.class.getDeclaredField("value");
						backedArrayField.setAccessible(true);
						backedArrayField.set(string, string.toUpperCase().toCharArray());
					}
					catch (NoSuchFieldException | SecurityException | IllegalArgumentException | IllegalAccessException e) {
						// handle exception
					}
				}</pre>				
			</div>

			<div class="step slide" data-x="2250" data-y="3750">
				<h2>Project coin / Compacter catch:after</em></h2>
				<ul>
					<li>a.k.a. &ldquo;multi-catch&rdquo;</li>
					<li>this is a union of types</li>
					<li>in the previous example, e is implicitly final</li>
					<li>multi-catch actually has a counterpart...</li>
				</ul>				
			</div>
			

			<div class="step slide" data-x="2250" data-y="4500">
				<h2>Project coin / Precise rethrow:before</em></h2>
				<pre class="brush: java">
				private void doNothing() throws MyException {} //MyException extends Exception

				private void doTwiceAsMuchAsThePreviousMethod() throws MyOtherException {} //MyOtherException extends Exception

				public void doSomething() throws Exception {
					try {
						doNothing();
						doTwiceAsMuchAsThePreviousMethod();
					}
					catch (Exception e) {
						//do something and
						throw e;
					}
				}</pre>				
			</div>
			

			<div class="step slide" data-x="2250" data-y="5250">
				<h2>Project coin / Precise rethrow:after</em></h2>
				<pre class="brush: java">
				private void doNothing() throws MyException {} //MyException extends Exception

				private void doTwiceAsMuchAsThePreviousMethod() throws MyOtherException {} //MyOtherException extends Exception

				public void doSomething() throws MyException, MyOtherException {//this wouldn't compile before Java 7
					try {
						doNothing();
						doTwiceAsMuchAsThePreviousMethod();
					}
					catch (Exception e) {
						//do something and
						throw e;
					}
				}</pre>				
			</div>
			

			<div class="step slide" data-x="3750" data-y="1500">
				<h2>Project coin / Diamonds:before</em></h2>
				<pre class="brush: java">
				private final Map&lt;List&lt;Class&lt;Thread&gt;&gt;, Map&lt;Void, Boolean&gt;&gt; mySuperStructure = new ConcurrentSkipListMap&lt;List&lt;Class&lt;Thread&gt;&gt;, Map&lt;Void, Boolean&gt;&gt;();</pre>				
			</div>
			

			<div class="step slide" data-x="3750" data-y="2250">
				<h2>Project coin / Diamonds:after</em></h2>
				<pre class="brush: java">
				private final Map&lt;List&lt;Class&lt;Thread&gt;&gt;, Map&lt;Void, Boolean&gt;&gt; mySuperStructure = new ConcurrentSkipListMap&lt;&gt;();</pre>				
			</div>
			

			<div class="step slide" data-x="5250" data-y="1500">
				<h2>Project coin / Match more:before</em></h2>
				<pre class="brush: java">
				//TODO</pre>				
			</div>

		</div><!-- END OF SLIDES -->

		<script src="js/impress.js"></script>
		<script>
     			SyntaxHighlighter.all()
		</script>	
		<!--[if lt IE 7 ]>
		<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.2/CFInstall.min.js"></script>
		<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
		<![endif]-->
	</body>
</html>
